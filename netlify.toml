[build]
command = "npm run build"
functions = "netlify/functions"
publish = "dist"
 # Only build when commit message contains [deploy] or [force-deploy]
 ignore = "bash scripts/ignore-netlify-build.sh"

# Cache optimized images between builds
[[plugins]]
  package = "netlify-plugin-cache"
  [plugins.inputs]
    paths = ["dist/images/portfolio", "public/images/portfolio"]

[dev]
targetPort = 3003
port = 8888

# Edge Functions for dynamic meta tag injection
[[edge_functions]]
path = "/work/*"
function = "meta-rewrite"

[[edge_functions]]
path = "/journal/*"
function = "meta-rewrite"

# Redirect /sitemap.xml to the dynamic sitemap function
[[redirects]]
from = "/sitemap.xml"
to = "/.netlify/functions/sitemap"
status = 200
force = true

# SPA fallback (must be last)
[[redirects]]
from = "/*"
to = "/index.html"
status = 200
